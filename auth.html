<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Auth â€” Login / Signup</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 30px;
      }
      .box {
        width: 400px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      input {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
      }
      button {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: none;
        background: #0d6efd;
        color: #fff;
        cursor: pointer;
      }
      .switch {
        text-align: center;
        margin-top: 12px;
        color: #666;
        cursor: pointer;
      }
      .small {
        font-size: 13px;
        color: #666;
        margin-top: 8px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <br><br><br><br><br><div class="box" id="auth-box"></div>

    <script>
      /*
Simple multi-user auth using localStorage keys:
- 'users' : JSON array of user objects { id, username, email, password, photo }
- 'loggedInUserId' : id of the currently logged-in user (string) or null
*/

      // Helpers
      function getUsers() {
        return JSON.parse(localStorage.getItem("users") || "[]");
      }
      function saveUsers(users) {
        localStorage.setItem("users", JSON.stringify(users));
      }
      function setLoggedInUserId(id) {
        if (id === null) localStorage.removeItem("loggedInUserId");
        else localStorage.setItem("loggedInUserId", id);
      }
      function getLoggedInUserId() {
        return localStorage.getItem("loggedInUserId");
      }
      function findUserByUsername(username) {
        return getUsers().find(
          (u) => u.username.toLowerCase() === username.toLowerCase()
        );
      }
      function findUserById(id) {
        return getUsers().find((u) => u.id === id);
      }

      // UI
      function showLogin() {
        document.getElementById("auth-box").innerHTML = `
    <h2 style="text-align:center">Log In</h2>

    <label><b>Username</b></label>
      <input id="login-username" placeholder="e.g johndoe_33" style="width:375px" />

    <label><b>Password</b></label>
      <input id="login-password" placeholder="**********" type="password" style="width:375px"/>

    <button id="login-btn">Log In</button>
    <p class="switch" id="to-signup">Don't have an account? Sign up</p>
  `;
        document.getElementById("to-signup").onclick = showSignup;
        document.getElementById("login-btn").onclick = login;
      }

      function showSignup() {
        document.getElementById("auth-box").innerHTML = `
    <h2 style="text-align:center">Create Account</h2>
    <label><b>Username</b></label>
      <input id="signup-username" placeholder="e.g johndoe_33" style="width:375px"/>

    <label><b>Email Address</b></label>
      <input id="signup-email" placeholder="johndoe@example.cpm" type="email" style="width:375px"/>

    <label><b>Password</b></label>
      <input id="signup-password" placeholder="**********" type="password" style="width:375px"/>

    <label><b>Profile Photo</b></label>
      <input id="signup-photo" type="file" accept="image/*" required style="width:375px"/>
      
    <button id="signup-btn">Sign Up</button>
    <p class="switch" id="to-login">Already have an account? Log in</p>
  `;
        document.getElementById("to-login").onclick = showLogin;
        document.getElementById("signup-btn").onclick = signup;
      }

      // Signup
      function signup() {
        const username = document
          .getElementById("signup-username")
          .value.trim();
        const email = document.getElementById("signup-email").value.trim();
        const password = document.getElementById("signup-password").value;
        const photoFile = document.getElementById("signup-photo").files[0];

        if (!username || !email || !password) {
          alert("Please fill all required fields.");
          return;
        }

        if (findUserByUsername(username)) {
          alert("That username is already taken. Pick another.");
          return;
        }

        const id = Date.now().toString(); // simple unique id
        const newUser = { id, username, email, password, photo: "" };

        function finishSignup() {
          const users = getUsers();
          users.push(newUser);
          saveUsers(users);
          alert("Account created! Please log in.");
          showLogin();
        }

        if (photoFile) {
          const reader = new FileReader();
          reader.onload = () => {
            newUser.photo = reader.result;
            finishSignup();
          };
          reader.readAsDataURL(photoFile);
        } else {
          finishSignup();
        }
      }

      function login() {
  const username = document.getElementById("login-username").value;
  const password = document.getElementById("login-password").value;

  const users = JSON.parse(localStorage.getItem("users")) || [];

  const match = users.find(u => u.username === username && u.password === password);

  if (!match) {
    alert("Incorrect username or password.");
    return;
  }

  localStorage.setItem("loggedInUser", JSON.stringify(match));
  alert("Login successful!");
  window.location.href = "index.html";
}


      // If already logged in, go to profile
      if (getLoggedInUserId()) {
        window.location.href = "profile.html";
      } else {
        showLogin();
      }
    </script>
  </body>
</html>
